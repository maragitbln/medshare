<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="MedShare">
<link rel="apple-touch-icon" href="icon.png">
<title>MedShare — Given Tracker</title>
<style>
  :root{--bg:#071126;--card:#0b1220;--muted:#9aa6b2;--accent:#6ee7b7;--danger:#f87171;--glass:rgba(255,255,255,0.03)}
  html,body{height:100%;margin:0;font-family:Inter,system-ui;color:#e6eef6;background:linear-gradient(180deg,#071126,#0b1220)}
  .wrap{max-width:820px;margin:12px auto;padding:14px}
  header{display:flex;align-items:center;gap:12px}
  .logo{width:56px;height:56px;background:linear-gradient(135deg,#22c1c3,#6ee7b7);border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#04202a}
  h1{margin:0;font-size:20px}
  p.lead{margin:4px 0 14px;color:var(--muted)}
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:12px;margin-top:12px}
  .card{background:rgba(255,255,255,0.02);padding:12px;border-radius:12px;box-shadow:0 8px 24px rgba(2,6,23,0.6)}
  .small{font-size:13px;color:var(--muted)}
  .row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--glass)}
  .time{font-weight:700}
  .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:var(--accent);cursor:pointer}
  .btn.active{background:linear-gradient(90deg,#22c1c3,#6ee7b7);color:#04202a;border:none}
  .btn-primary{background:linear-gradient(90deg,#22c1c3,#6ee7b7);color:#04202a;border:none;padding:10px 16px;border-radius:12px;cursor:pointer}
  .danger{background:var(--danger);color:#111;border:none;padding:10px 12px;border-radius:10px}
  input,select{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  .history{margin-top:12px}
  .day{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.02)}
  .circle{width:26px;height:26px;border-radius:50%;border:2px solid rgba(255,255,255,0.06);position:relative;overflow:hidden}
  .circle.half::before{content:"";position:absolute;left:0;top:50%;width:100%;height:50%;background:linear-gradient(90deg,#6ee7b7,#22c1c3)}
  .circle.full{background:linear-gradient(90deg,#22c1c3,#6ee7b7);border-color:transparent}
  .section-title{font-size:16px;margin-top:18px;margin-bottom:8px;color:var(--muted)}
  footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center}
  .hidden{display:none}
</style>
</head>
<body>
<div class="wrap">
<header>
  <div class="logo">MS</div>
  <div>
    <h1>MedShare</h1>
    <p class="lead">Shared medication tracker — quick logging from Shortcuts</p>
  </div>
</header>
<div id="pinCard" class="card" style="margin-top:12px;">
  <div style="display:flex;align-items:center;justify-content:space-between;">
    <div>
      <div style="font-weight:700">Unlock MedShare</div>
      <div class="small">Enter PIN to see dashboard. Add to Home Screen to stay unlocked.</div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <input id="pinInput" type="password" placeholder="PIN" style="width:120px" />
      <button id="pinBtn" class="btn-primary">Unlock</button>
    </div>
  </div>
  <div id="pinMsg" class="small" style="margin-top:8px;"></div>
</div>
<div id="appUI" class="hidden">
  <div class="grid">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:700">Today's schedule</div>
          <div class="small">Standard times: 06:30 and 17:30</div>
        </div>
        <div style="text-align:right">
          <div class="small">Last given</div>
          <div id="lastGiven" class="small">—</div>
        </div>
      </div>
      <div style="margin-top:12px" class="row">
        <div>
          <div class="time">06:30</div>
          <div class="small">Aspirin</div>
        </div>
        <button class="btn" id="amBtn">Given</button>
      </div>
      <div class="row">
        <div>
          <div class="time">17:30</div>
          <div class="small">Aspirin</div>
        </div>
        <button class="btn" id="pmBtn">Given</button>
      </div>
      <div class="history">
        <div class="section-title">Past 7 days</div>
        <div id="weekHistory"></div>
      </div>
    </div>
    <div class="card">
      <div style="display:flex;flex-direction:column;gap:10px">
        <div>
          <div style="font-weight:700">Manual quick log</div>
        </div>
        <input id="manualUser" value="Bart">
        <input id="manualMed" value="Aspirin">
        <select id="manualTime">
          <option value="06:30">06:30</option>
          <option value="17:30">17:30</option>
        </select>
        <button id="manualLogBtn" class="btn-primary">Log manual</button>
        <hr style="opacity:0.06;margin:12px 0">
        <div>
          <div style="font-weight:700">Danger zone</div>
        </div>
        <button id="clearBtn" class="danger">Clear all</button>
        <div class="small" id="shortcutExample"></div>
      </div>
    </div>
  </div>
  <footer>
    <div class="small">Add to Home Screen to keep dashboard unlocked.</div>
  </footer>
</div>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
const SECRET_PIN="12psab92";const WRITE_SECRET="2430sdfnjh349skhf9";const UNLOCK_DURATION_MS=7*24*3600*1000;
const firebaseConfig={apiKey:"AIzaSyB09h7xfQXCCXu_TjZkG7Ro59HFzQtrW8c",authDomain:"medtrack-9b220.firebaseapp.com",projectId:"medtrack-9b220",storageBucket:"medtrack-9b220.appspot.com",messagingSenderId:"419299696230",appId:"1:419299696230:web:509ed433ac9a391b4797a7"};
const app=initializeApp(firebaseConfig);const db=getFirestore(app);
const pinCard=document.getElementById("pinCard");const appUI=document.getElementById("appUI");
function todayKey(){return new Date().toISOString().slice(0,10)}
async function loadToday(){const ref=doc(db,"days",todayKey());const snap=await getDoc(ref);return snap.exists()?snap.data():{amGiven:false,pmGiven:false}}
function renderButtons(state){document.getElementById("amBtn").classList.toggle("active",state.amGiven);document.getElementById("pmBtn").classList.toggle("active",state.pmGiven)}
async function toggleSlot(slot){const ref=doc(db,"days",todayKey());const data=await loadToday();data[slot]=!data[slot];data.count=(data.amGiven?1:0)+(data.pmGiven?1:0);await setDoc(ref,data);renderButtons(data);renderWeek()}
document.getElementById("amBtn").onclick=()=>toggleSlot("amGiven");document.getElementById("pmBtn").onclick=()=>toggleSlot("pmGiven");
document.getElementById("pinBtn").onclick=()=>{const val=document.getElementById("pinInput").value;if(val===SECRET_PIN){pinCard.classList.add("hidden");appUI.classList.remove("hidden");localStorage.setItem("ms_unlocked",Date.now());loadToday().then(renderButtons).then(renderWeek);}else document.getElementById("pinMsg").textContent="Wrong PIN"};
function checkUnlock(){const t=localStorage.getItem("ms_unlocked");if(t&&Date.now()-Number(t)<UNLOCK_DURATION_MS){pinCard.classList.add("hidden");appUI.classList.remove("hidden");loadToday().then(renderButtons).then(renderWeek)}}checkUnlock();
async function renderWeek(){const wrap=document.getElementById("weekHistory"),days=[];wrap.innerHTML="";for(let i=6;i>=0;i--){const d=new Date(Date.now()-i*86400000).toISOString().slice(0,10);const snap=await getDoc(doc(db,"days",d));let count=0;if(snap.exists()){const x=snap.data();count=(x.amGiven?1:0)+(x.pmGiven?1:0)}const div=document.createElement("div");div.className="day";const c=document.createElement("div");c.className="circle";(count===1)&&(c.classList.add("half"));(count===2)&&(c.classList.add("full"));div.innerHTML=`${d}`;div.appendChild(c);wrap.appendChild(div)}}
</script>
</body>
</html>
